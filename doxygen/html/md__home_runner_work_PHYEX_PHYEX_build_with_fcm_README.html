<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PHYEX: OFFLINE COMPILATION</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PHYEX
   </div>
   <div id="projectbrief">PHYsique EXternalis√©e</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">OFFLINE COMPILATION </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md104"></a>
Directory organisation</h1>
<p>The different directories are:</p><ul>
<li>the fcm subdirectory contains the fcm tool. In the PHYEX git repository, this directory is empty. It will be populated on first call to the make_fcm.sh script and content is not tracked by git.</li>
<li>the fiat subdirectory contains the fiat package from the ECMWF. In the PHYEX git repository, this directory is empty. It will be populated on first call to the make_fcm.sh script and content is not tracked by git.</li>
<li>the arch subdirectory contains architecture specific files. An alternative arch directory can be provided on the command line when calling the make_fcm.sh script. And, arch files are also (and in first place) looked for in the ${HOME}/.phyex/fcm_arch directory.</li>
<li>arch_* subdirectories are automatically created by the make_fcm.sh script and are not tracked by git.</li>
</ul>
<h1><a class="anchor" id="autotoc_md105"></a>
Compilation</h1>
<p>The make_fcm.sh script will:</p><ul>
<li>populate the fcm and fiat directories on first call</li>
<li>create the arch_$ARCH directory, poulate it with arch specific files and a compilation script</li>
<li>populate the compilation directory with source code (using the prep_code.sh script). Source code transformation can occur during this step (in particular using the PYFT_OPTS variable set in the architecture env file).</li>
<li>execute the newly created compilation script</li>
</ul>
<p>Note: full cleaning is achieved by removing the arch_* subdirectories. Note: documentation of the make_fcm.sh script can be obtained with the -h option</p>
<h1><a class="anchor" id="autotoc_md106"></a>
Architecture files</h1>
<p>By default, the code is compiled using the <em>gnu</em> configuration. This configuration is stored in the arch-gnu.env and arch-gnu.fcm files in the arch directory. Other acthitectures exist in this directory. In addition, other architectures can be added in the ${HOME}/.phyex/fcm_arch directory.</p>
<p>The fcm file contains the compilation options to be used by the fcm tool. Such a file can be build using a gmkfile with the command: make_fcm.sh &ndash;gmkfile &lt;GMKFILE&gt; &ndash;arch &lt;new arch name&gt; The env file is sourced several times:</p><ul>
<li>before populating the build directory with the source code. Indeed, during this second step, the source code is copied or cloned and transformed by the pyft_tool.py script. The active transformations are controlled by the &ndash;noexpand/&ndash;expand options given to the different check_commit_* scripts and by the PYFT_OPTS that can be set in the env file (only for testprogs). The syntax is given below.</li>
<li>just before the compilation step for loading modules or to defined (LIBS variable) the list of system libraries to link with (defaults to 'rt ld' to link with librt and libdl).</li>
<li>just before execution to set environment variable specific to this architecture needed during execution</li>
</ul>
<p>The PYFT_OPTS environment variable can contain a multi-lines string. For each file, the PYFT_OPTS is read line by line and the last applicable line is used. A line can take one of these two forms:</p><ul>
<li>FILE_DESCRIPTOR:=:OPTIONS where FILE_DESCRIPTOR is a regular expression to test against the filename. If there is a match, the OPTIONS can be used for the file. The regular expression is tested using 'grep -e'.</li>
<li>OPTIONS If the line doesn't contain the FILE_DESCRIPTOR part, it applies to all source code.</li>
</ul>
<p>For example, to transform all source code in lower case: </p><blockquote class="doxtable">
<p>export OPTS='&ndash;lowerCase'; pyft_tool.py &ndash;pyft_opts_env OPTS ... </p>
</blockquote>
<p>To transform all source code in lower case, except routines in turb directory which must be in upper case but keeping the <a class="el" href="turb_8F90.html">turb.F90</a> in lower case: </p><blockquote class="doxtable">
<p>export OPTS='&ndash;lowerCase ^turb/:=:&ndash;upperCase ^turb/turb..90:=:&ndash;lowerCase'; pyft_tool.py &ndash;pyft_opts_env OPTS ... </p>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
