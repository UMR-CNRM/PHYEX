<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PHYEX: PHYEX INTEGRATOR DOCUMENTATION</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PHYEX
   </div>
   <div id="projectbrief">PHYsique EXternalisée</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">PHYEX INTEGRATOR DOCUMENTATION</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md43"></a> </p>
<h1><a class="anchor" id="autotoc_md44"></a>
About this section</h1>
<p>This document is intended for integrators who are in charge of assembling contributions received through pull requests.</p>
<h1><a class="anchor" id="autotoc_md45"></a>
Branches and norms</h1>
<p>Regarding array-syntax, the <a class="el" href="md__2home_2runner_2work_2PHYEX_2PHYEX_2docs_2CodingNorms.html">applicable norm</a> depends on the branch:</p>
<ul>
<li>The legacy main branch of PHYEX (and all branches based on main) was written using array-syntax</li>
<li>The master branch is written using array-syntax with mnh_expand directives</li>
<li>arome specific branches based on the master branch are written using DO loops</li>
<li>mesonh specific branches based on the master branch are written using array-syntax</li>
</ul>
<p>Pull requests can be received on all these kind of branches and must be merged into the master branch with according norm.</p>
<h1><a class="anchor" id="autotoc_md46"></a>
Normal workflow for a contribution developed in AROME and HARMONIE-AROME</h1>
<h2><a class="anchor" id="autotoc_md47"></a>
Scientific contributions until cycle 49t1</h2>
<p><img src="./AROMEworkflow1.svg" alt="" style="pointer-events: none;" class="inline"/></p>
<p>The pull request comes from the IAL integrator. It must be based on an arome specific branch.</p>
<p>Details for point 6, the PHYEX administrator:</p>
<ul>
<li>validates (see below) the contribution</li>
<li>integrates the contribution in the arome branch and merges it in the master branch</li>
<li>regularly, he tags a new (minor) version of the master branch</li>
<li>when asked by the IAL integrator, he builds a new arome specific branch</li>
<li>when an arome specific branch is used in an official cycle, the arome specific branch is tagged accordingly</li>
</ul>
<h2><a class="anchor" id="autotoc_md48"></a>
Refactoring contributions from now on, and scientific contributions after cycle 49t1</h2>
<p><img src="./AROMEworkflow2.svg" alt="" style="pointer-events: none;" class="inline"/></p>
<p>The pull request comes directly from a developer. It must be based on an arome specific branch.</p>
<p>Details for point 6:</p>
<ul>
<li>The PHYEX administrator checks the pull requests in the other applications (see below)</li>
<li>The IAL integrator integrates the contribution on the arome specific branch</li>
<li>The PHYEX administrator<ul>
<li>integrates the modifications in the master branch</li>
<li>regularly, tags a new (minor) version of the master branch</li>
<li>when asked by the IAL integrator, builds a new arome specific branch (see below)</li>
<li>when an arome specific branch is used in an official cycle, the arome specific branch is tagged accordingly</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md49"></a>
PHYEX - IAL compatibility</h2>
<p>Because the interfaces between the physics and the rest of the model can change, the right version of IAL to use with PHYEX must be referenced in the 'src/arome/ial_version.json' file.</p>
<p>If no IAL version is able to receive directly the PHYEX physics, an 'ext' directory can be added to hold the files that must be modified on top of the IAL version described in the 'src/arome/ial_version.json' file.</p>
<p>In addition, if some files must be excluded from the IAL compilation, they must be listed in the 'src/arome/gmkpack_ignored_files' file.</p>
<h1><a class="anchor" id="autotoc_md50"></a>
Normal workflow for a contribution developed in MESONH</h1>
<p>The developer sends its pull request on the Méso-NH repository (the physics source code is embedded in the model source code).</p>
<p>Integration details:</p>
<ul>
<li>The Meso-NH integrator extracts, from the different pull requests, what concern the PHYEX repository and send a pull request on PHYEX based on a mesonh specific branch</li>
<li>The PHYEX administrator:<ul>
<li>validates (see below) the contribution</li>
<li>integrates the contribution in the mesonh branch and merges it in the master branch</li>
<li>regularly, he tags a new (minor) version of the master branch</li>
<li>when asked by the Meso-NH integrator, he builds a new mesonh specific branch (see below)</li>
<li>when a mesonh specific branch is used in an official release, the mesonh specific branch is tagged accordingly</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md51"></a>
Normal workflow for another contribution</h1>
<p>Pull requests must be based on the master branch.</p>
<p>The PHYEX administrator:</p>
<ul>
<li>validates (see below) the contribution</li>
<li>integrates the contribution in the master branch</li>
<li>regularly, he tags a new (minor) version of the master branch</li>
</ul>
<h1><a class="anchor" id="autotoc_md52"></a>
Tests</h1>
<p>The source code must follow strict mnh_expand directives (described in the <a class="el" href="md__2home_2runner_2work_2PHYEX_2PHYEX_2docs_2CodingNorms.html">Coding Norms documentation</a>). The script verify_mnh_expand.py must be used to give an additional check.</p>
<p>In addition to the scientific validation, the following tests must give the same results (with bit-reproducibility) in each of the model (arome, mesonh and testprogs):</p>
<ul>
<li>compilation transforming the mnh_expand directives in DO loop</li>
<li>compilation keeping the array-syntax</li>
<li>execution with a different number of processors</li>
</ul>
<p>When possible, the new version of PHYEX must reproduce the old results (scientific modifications must be activated with namelist keys).</p>
<h1><a class="anchor" id="autotoc_md53"></a>
Code preparation</h1>
<p>The source code stored in the master branches must be usable by all the models. But these models can have contradictory constraints. To bypass this difficulty, the source code is preprocessed before being included in the compilation environment of each model.</p>
<p>This preprocessing step can be done on the fly (in this case the preprocessing tools must be available aside of the compilation tools), or the result of the preprocessing can be stored in the PHYEX package (in this case, the preprocessing is done once and can be used by several users). This second possibility is useful to historize the source code really used during the model compilation and enables contributions to the PHYEX package without the need of the preprocessing tools.</p>
<p>The preprocessed versions of the source code are put in branches named &lt;model&gt;_&lt;commit&gt; where &lt;model&gt; is the name of the model for which the source code have been preprocessed and &lt;commit&gt; is the commit hash used as a basis.</p>
<p>The preprocessing tools are described in the <a class="el" href="md__2home_2runner_2work_2PHYEX_2PHYEX_2docs_2Tools.html">Tools documentation</a>.</p>
<h1><a class="anchor" id="autotoc_md54"></a>
Code validation</h1>
<p>The testing.h script can be automatically run to help for validation. This script is described in the <a class="el" href="md__2home_2runner_2work_2PHYEX_2PHYEX_2docs_2Tools.html">Tools documentation</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
